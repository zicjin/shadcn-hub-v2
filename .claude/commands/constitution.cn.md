---
description: 通过交互式或提供的原则输入创建或更新项目章程，确保所有相关的模板保持同步。
---

用户输入可以由代理直接提供，也可以作为命令参数提供 - 在继续处理提示之前，您**必须**考虑它（如果非空）。

用户输入:

$ARGUMENTS

您正在更新位于 `.specify/memory/constitution.md` 的项目章程。此文件是一个模板，包含方括号中的占位符令牌（例如 `[PROJECT_NAME]`，`[PRINCIPLE_1_NAME]`）。您的工作是 (a) 收集/派生具体值，(b) 精确填充模板，以及 (c) 在所有相关的工件中传播任何修订。

请遵循此执行流程：

1.  加载位于 `.specify/memory/constitution.md` 的现有章程模板。
    *   识别所有格式为 `[ALL_CAPS_IDENTIFIER]` 的占位符令牌。
    **重要提示**：用户可能需要比模板中使用的原则更少或更多的原则。如果指定了数量，请遵循该数量 - 遵循通用模板。您将相应地更新文档。

2.  为占位符收集/派生值：
    *   如果用户输入（对话）提供了值，请使用它。
    *   否则，从现有的仓库上下文（README、文档、如果嵌入了先前的章程版本）中推断。
    *   对于治理日期：`RATIFICATION_DATE` 是原始采纳日期（如果未知，请询问或标记为 TODO），如果进行了更改，`LAST_AMENDED_DATE` 是今天，否则保留以前的日期。
    *   `CONSTITUTION_VERSION` 必须根据语义化版本控制规则递增：
        *   MAJOR：向后不兼容的治理/原则移除或重新定义。
        *   MINOR：添加了新的原则/部分或实质性扩展了指南。
        *   PATCH：澄清、措辞、拼写错误修复、非语义性优化。
    *   如果版本升级类型不明确，请在最终确定前提出推理。

3.  起草更新后的章程内容：
    *   用具体文本替换每个占位符（除了项目选择暂不定义的、有意保留的模板槽之外，不应再有方括号令牌——明确说明任何保留的理由）。
    *   保留标题层级结构，注释一旦被替换就可以删除，除非它们仍然能增加澄清性指导。
    *   确保每个原则部分：简洁的名称行、捕获不可协商规则的段落（或项目符号列表）、如果不明显则提供明确的基本原理。
    *   确保治理部分列出修订程序、版本控制策略和合规性审查期望。

4.  一致性传播清单（将先前的清单转换为主动验证）：
    *   阅读 `.specify/templates/plan-template.md` 并确保任何“章程检查”或规则与更新后的原则保持一致。
    *   阅读 `.specify/templates/spec-template.md` 以了解范围/需求的一致性——如果章程添加/删除了强制性部分或约束，则进行更新。
    *   阅读 `.specify/templates/tasks-template.md` 并确保任务分类反映了新的或已删除的原则驱动的任务类型（例如，可观察性、版本控制、测试纪律）。
    *   阅读 `.specify/templates/commands/*.md` 中的每个命令文件（包括此文件），以验证在需要通用指南时，没有过时的引用（仅限代理特定名称，如 CLAUDE）保留。
    *   阅读任何运行时指南文档（例如 `README.md`、`docs/quickstart.md` 或如果存在的代理特定指南文件）。更新对已更改原则的引用。

5.  生成同步影响报告（更新后，作为 HTML 注释预置在章程文件的顶部）：
    *   版本变更：旧 → 新
    *   修改后的原则列表（如果重命名，则为旧标题 → 新标题）
    *   新增部分
    *   已删除部分
    *   需要更新的模板（✅ 已更新 / ⚠ 待定）及其文件路径
    *   如果有任何占位符被有意推迟，则列出待办事项。

6.  最终输出前的验证：
    *   没有剩余的未解释的方括号令牌。
    *   版本行与报告匹配。
    *   日期为 ISO 格式 YYYY-MM-DD。
    *   原则是陈述性的、可测试的，并且没有模糊的语言（“应该”→ 在适当时用 MUST/SHOULD 的理由替换）。

7.  将完成的章程写回 `.specify/memory/constitution.md`（覆盖）。

8.  向用户输出最终摘要，包括：
    *   新版本和升级理由。
    *   任何标记为需要手动跟进的文件。
    *   建议的提交消息（例如，`docs: 将章程修订至 vX.Y.Z（原则补充 + 治理更新）`）。

格式和样式要求：
-   完全按照模板中的 Markdown 标题使用（不要降级/提升级别）。
-   换行较长的理由以保持可读性（理想情况下<100个字符），但不要用尴尬的断行来强制执行。
-   在各部分之间保持一个空行。
-   避免尾随空格。

如果用户提供部分更新（例如，仅修订一个原则），仍然执行验证和版本决策步骤。

如果缺少关键信息（例如，批准日期的确未知），插入 `TODO(<FIELD_NAME>): 解释` 并将其包含在同步影响报告的延迟项目中。

不要创建新模板；始终在现有的 `.specify/memory/constitution.md` 文件上操作。